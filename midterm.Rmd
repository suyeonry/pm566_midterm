---
title: "Midterm"
author: "Suyeon Ryu"
date: '2020 10 5'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



# Introduction


Colorectal cancer was known to have low incidence rate compared to other types of cancers in U.S.. However, in the recent years, it was discussed that the proportion of colon cancer in U.S. populations has increased, and the incidence and mortality were different from West Coast to East Coast, with unknown cause. This paper will discuss and compare the incidence and mortality rate of colon cancers in U.S. population. Specifically, 3 states representing West Coast are compared to 5 states which represent East Coast, through data exploration analyses.  



# Methods

## Data Sources

### Cancer Incidence / Mortality Data 
Data on cancer incidences/mortalities during 1999 through 2017 were obtained from the United States Cancer Statistics(USCS), the Centers for Disease Control and Prevention. As our focus is specifically colorectal cancers, all data for other cancers were omitted from the data set. Then, due to the limited computing power, the 1 in every 20 data was used to perform the data exploratory analysis. Any outliers were assessed from the scatter-plot, and was computationally removed from the data set for the further analyses. RStudio was used 

 
### Demographic characteristics 






```{r,echo=FALSE, include=FALSE}
library(tidyverse)
library(ggplot2)
library(data.table)
library(dplyr)

midt<- data.table::fread("C:/Users/suyeo/PM566/midterm/data/BYAREA.txt")


cln <- midt[midt$SITE == "Colon and Rectum"]

cln_mort <- cln[cln$EVENT_TYPE == "Mortality"]
cln_inc <- cln[cln$EVENT_TYPE == "Incidence"]

# Noticed some rates are still characters. In order to plot, need to change to numeric!

cln_mort <- cln_mort %>% mutate(
  CRUDE_RATE = as.numeric(CRUDE_RATE),
  YEAR = as.numeric(YEAR),
  AGE_ADJUSTED_RATE = as.numeric(AGE_ADJUSTED_RATE),
)


cln_inc <- cln_inc %>% mutate(
  CRUDE_RATE = as.numeric(CRUDE_RATE),
  YEAR = as.numeric(YEAR),
  AGE_ADJUSTED_RATE = as.numeric(AGE_ADJUSTED_RATE),
)


# checking and removing missing values 
cln_mort %>%
  select(everything()) %>%
  summarise_all(funs(sum(is.na(.))))

cln_inc %>%
  select(everything()) %>%
  summarise_all(funs(sum(is.na(.))))

cln_mort <- na.omit(cln_mort)
cln_inc <- na.omit(cln_inc)



```


```{r, eval=TRUE, echo=FALSE}


# trimming down (subsetting) the data because it is too big

cln_inc <- cln_inc %>% group_by(CRUDE_RATE) %>%
  slice(seq(1, n(), by = 20))
cln_mort <-  cln_mort %>% group_by(CRUDE_RATE) %>%
  slice(seq(1, n(), by = 20))
```

```{r}
range(cln_inc$YEAR)

# Incidence rate table

c99<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==1999])
c00<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2000])
c01<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2001])
c02<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2002])
c03<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2003])
c04<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2004])
c05<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2005])
c06<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2006])
c07<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2007])
c08<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2008])
c09<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2009])
c10<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2010])
c11<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2011])
c12<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2012])
c13<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2013])
c14<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2014])
c15<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2015])
c16<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2016])
c17<-summary(cln_inc$CRUDE_RATE[cln_inc$YEAR==2017])


table1<-rbind(c99,c00,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17)
inc_median <- table1[,3]
inc_std <- table1[,5]-table1[,2]
inc_mean <- table1[,4]

inc_median <- round(inc_median, digits=1)
inc_std <- round(inc_std, digits=2)
inc_mean <- round(inc_mean, digits=2)


rnames<-c('1999','2000','2001','2002','2003','2004','2005','2006','2007','2008','2009','2010','2011','2012','2013','2014','2015','2016','2017')
cnames <- c("YEAR","Median Rate","S.D.","Mean")

inc_table <- cbind(rnames, inc_median, inc_std, inc_mean)
inc_table <- knitr::kable(inc_table,row.names=FALSE, col.names=cnames,caption = "Table1. U.S. Colon Incidence Rate History",align = "cccc")

inc_table

               


```



```{r}

## Mortality Table 

c99<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==1999])
c00<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2000])
c01<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2001])
c02<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2002])
c03<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2003])
c04<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2004])
c05<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2005])
c06<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2006])
c07<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2007])
c08<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2008])
c09<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2009])
c10<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2010])
c11<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2011])
c12<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2012])
c13<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2013])
c14<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2014])
c15<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2015])
c16<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2016])
c17<-summary(cln_mort$CRUDE_RATE[cln_mort$YEAR==2017])


table1<-rbind(c99,c00,c01,c02,c03,c04,c05,c06,c07,c08,c09,c10,c11,c12,c13,c14,c15,c16,c17)
mort_median <- table1[,3]
mort_std <- table1[,5]-table1[,2]
mort_mean <- table1[,4]

mort_median <- round(mort_median, digits=1)
mort_std <- round(mort_std, digits=2)
mort_mean <- round(mort_mean, digits=2)


rnames<-c('1999','2000','2001','2002','2003','2004','2005','2006','2007','2008','2009','2010','2011','2012','2013','2014','2015','2016','2017')
cnames <- c("YEAR","Median Rate","S.D.","Mean")

mort_table <- cbind(rnames, mort_median, mort_std, mort_mean)
mort_table <- knitr::kable(mort_table,row.names=FALSE, col.names=cnames,caption = "Table2. U.S. Colon Mortality Rate History",align = "cccc")

mort_table

```




# Preliminary Results 

```{r, eval=TRUE,echo=FALSE}

# Trend of colon cancer incidence and mortality over the years (maybe line graph)

ggplot(cln_mort, aes(x=YEAR, y=CRUDE_RATE))+
  geom_point(color="red")+
  theme_minimal()+
  geom_smooth(method="loess", color="red", fill="darkred")+
  ggtitle("U.S. Colon Cancer Mortality Crude Rate")


ggplot(cln_inc, aes(x=YEAR, y=CRUDE_RATE))+
  geom_point(color="blue")+
  theme_minimal()+
  geom_smooth(method="loess")+
  ggtitle("U.S. Colon Cancer Incidence Crude Rate")

```






# EAST versus WEST
```{r}
#EAST versus WEST

#EAST will include New York, Pennsylvania, New Jersey, Virginia, North and South Carolina, Georgia
#WEST will include Washington, Oregon, California

us_map <- map_data("state")

east_states <- c("new york", "pennsylvania","new jersey","virginia","north carolina","south carolina","georgia")
west_states <- c("washington","oregon","california")

ggplot(us_map, aes(x=long, y=lat, group = group)) +
  geom_polygon(fill="grey", colour = "white") +
  geom_polygon(fill="palevioletred1", data = filter(us_map, region %in% east_states)) +
  geom_polygon(fill="mediumpurple", data = filter(us_map, region %in% west_states))+
  ggtitle("U.S Colon Cancer Comparison Covered Area East versus West")


#make new variables for east and west states

cln_inc$westeast <- ifelse(cln_inc$AREA == "New York"|cln_inc$AREA == "Pennsylvania"|cln_inc$AREA == "New Jersey"|cln_inc$AREA == "Virginia"|cln_inc$AREA == "North Carolina"|cln_inc$AREA == "South Carolina"|cln_inc$AREA == "Georgia", "East Coast",
                           ifelse(cln_inc$AREA =="Washington"|cln_inc$AREA =="Oregon"|cln_inc$AREA == "California", "West Coast","Not Considered" ))





#plotting bargraph of crude rate including "non considering area"
p <- ggplot(data=cln_inc, aes(x=YEAR, y=CRUDE_RATE, fill=westeast))+
  geom_bar(stat="identity", color="black", position=position_dodge())+
  scale_fill_manual(values=c("palevioletred1","#999999","mediumpurple"))+
  theme_minimal()+
  ggtitle("U.S. Colon Cancer Incidence Crude Rate by Areas")

p

#excluding not considered area from the data set

cln3 <-cln_inc[!(cln_inc$westeast=="Not Considered"),]

#plotting scatterplot of crude rate east versus west

ggplot(data=cln3, aes(x=YEAR, y=CRUDE_RATE, color=westeast, shape=westeast)) +
  geom_point() + 
  geom_smooth(method=lm, se=TRUE, fullrange=TRUE)+
  scale_shape_manual(values=c(3, 17))+ 
  scale_color_manual(values=c("palevioletred1","mediumpurple"))+
  scale_size_manual(values=c(7,7))+
  theme(legend.position="right")+
  ggtitle("U.S. Colon Cancer Incidence Crude Rate West Coast vs. East Coast")




```



# age adjusted 
```{r}

#removing outlier
cln4 <- subset(cln3, cln3$AGE_ADJUSTED_RATE < 130)

#plot 
ggplot(data=cln4, aes(x=YEAR, y=AGE_ADJUSTED_RATE, fill=westeast))+
  geom_bar(stat="identity", color="black", position=position_dodge())+
  scale_fill_manual(values=c("palevioletred1","mediumpurple"))+
  theme_minimal()

ggplot(data=cln4, aes(x=YEAR, y=AGE_ADJUSTED_RATE, color=westeast, shape=westeast)) +
  geom_point() + 
  geom_smooth(method=lm, se=TRUE, fullrange=TRUE)+
  scale_shape_manual(values=c(3, 17))+ 
  scale_color_manual(values=c("palevioletred1","mediumpurple"))+
  scale_size_manual(values=c(7,7))+
  theme(legend.position="right")+
  ggtitle("U.S. Colon Cancer AGE Adjusted Rate West Coast vs. East Coast")



```





```{r}
# Do the same with mortality 



cln_mort$westeast <- ifelse(cln_mort$AREA == "New York"|cln_mort$AREA == "Pennsylvania"|cln_mort$AREA == "New Jersey"|cln_mort$AREA == "Virginia"|cln_mort$AREA == "North Carolina"|cln_mort$AREA == "South Carolina"|cln_mort$AREA == "Georgia", "East Coast",
                           ifelse(cln_mort$AREA =="Washington"|cln_mort$AREA =="Oregon"|cln_mort$AREA == "California", "West Coast","Not Considered" ))





#plotting bargraph of crude rate including "non considering area"
mort2 <- ggplot(data=cln_mort, aes(x=YEAR, y=CRUDE_RATE, fill=westeast))+
  geom_bar(stat="identity", color="black", position=position_dodge())+
  scale_fill_manual(values=c("palevioletred1","#999999","mediumpurple"))+
  theme_minimal()

mort2

#excluding not considered area from the data set

mort3 <-cln_mort[!(cln_mort$westeast=="Not Considered"),]

#plotting scatterplot of crude rate east versus west


ggplot(data=mort3, aes(x=YEAR, y=CRUDE_RATE, color=westeast, shape=westeast)) +
  geom_point() + 
  geom_smooth(method=lm, se=TRUE, fullrange=TRUE)+
  scale_shape_manual(values=c(3, 17))+ 
  scale_color_manual(values=c("palevioletred1","mediumpurple"))+
  scale_size_manual(values=c(7,7))+
  theme(legend.position="right")+
  ggtitle("U.S. Colon Cancer Mortality Crude Rate West Coast vs. East Coast")



ggplot(data=mort3, aes(x=YEAR, y=AGE_ADJUSTED_RATE, color=westeast, shape=westeast)) +
  geom_point() + 
  geom_smooth(method=lm, se=TRUE, fullrange=TRUE)+
  scale_shape_manual(values=c(3, 17))+ 
  scale_color_manual(values=c("palevioletred1","mediumpurple"))+
  scale_size_manual(values=c(7,7))+
  theme(legend.position="right")+
  ggtitle("U.S. Colon Cancer AGE Adjusted Mortality Rate West Coast vs. East Coast")



```


